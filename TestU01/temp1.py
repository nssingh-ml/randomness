import math

def coupon_collector_test_binary(data, confidence_level=0.01):
    """
    Implements the Coupon Collector's Test for randomness for binary sequences (0 and 1).

    Parameters:
        data (list): Sequence of binary values (0s and 1s).
        confidence_level (float): Significance level to determine randomness. Default is 0.01.

    Returns:
        Tuple: (p_value, result, details), where p_value is the calculated p-value, 
               result is "Random" or "Non-Random", and details include observed and expected values.
    """
    # Ensure input is binary
    if not all(bit in (0, 1) for bit in data):
        raise ValueError("Input data must only contain binary values (0 and 1).")

    n = len(data)
    num_symbols = 2  # Only two symbols: 0 and 1

    if n < num_symbols:
        raise ValueError("Input data is too short to contain both symbols (0 and 1).")

    # Count occurrences of each symbol
    count_0 = data.count(0)
    count_1 = data.count(1)

    symbol_counts = [count_0, count_1]

    # Check if both symbols are present
    if any(count == 0 for count in symbol_counts):
        raise ValueError("Not all symbols (0 and 1) are present in the data.")

    # Calculate observed and expected values
    observed = sum(count > 0 for count in symbol_counts)
    expected = num_symbols * (1 - ((num_symbols - 1) / num_symbols) ** n)

    # Calculate variance
    variance = num_symbols * (1 - ((num_symbols - 1) / num_symbols) ** n) * ((num_symbols - 1) / num_symbols) ** n

    # Ensure variance is positive
    if variance <= 0:
        raise ValueError("Variance is non-positive. Cannot perform the test.")

    # Calculate z-score
    z = (observed - expected) / math.sqrt(variance)

    # Convert z-score to p-value
    p_value = 2 * (1 - math.erf(abs(z) / math.sqrt(2)))

    # Determine randomness based on p-value
    result = "Random" if p_value > confidence_level else "Non-Random"

    # Include details in output
    details = {
        "observed": observed,
        "expected": expected,
        "variance": variance,
        "z_score": z
    }

    return p_value, result, details


if __name__ == "__main__":
    # Binary input
    binary_input = "11010100111001010101101111111001100001111110001011100001101110001100111001111110011110111110000011011010101011011000111100011011001001011111110010000001000111000110101000100011011101001111100000100011000001011110001011010010011100101111010110001001000010011000111100111100011001000000110010011010011001100100000011111101110001000011111011001011100001111101101110010010000100110100101000100010100110010111110010100011101100110111111110100111110001010011010010010010111111001011001001001000000011000110101011011010101001101110111100110001000010001100101100001100111100011011011000111011110110101111001110101010110001111000110000100011110100110010101110010101111010000100101010001100110010110000100111010011101001010100110001100111111101101101011000100011000101000011100101011000100101000101110001100100101100100010111010011010110100011110111110011100111011101010010111000010101010111101101011101010001101101000010100011010011100011101000100110011011100001000110111110110000011101011101100111001001100001010101101011001100010101111110011100111000110110000011111000111000001100100110101110111101111111101110110111100110011010001110110110101011000111100111111001011011100011010001001010001011000011100101010111001101101101100001001101010000010100100011011010001011111011101011110101111110001111000000100111001101000010101100011011010000001101000111000100101011111010010010011000010110111001001011000011101011100010010111111000101100011010001010100111110110110100000001000000101110100000010011101001000001111010011111001101111110111000011010001000001011001110100110011011000001101111010010010000000001111000011011100101010001000001101100101011011110111011100111101100001001011001010111110111101101111010010001101101101110000101011101001110001010001011101001001000101111010100000011010101101000010001001001011001110001100001100101101111010010010110110000100000011110010000110000011101100100110101111011010101100111101001101000111001001011101010110000011100011010101010101000111010111010110101110111010011111011010001111001110001100001100100011111101000101110001111001000110110110010000101000101110010101101111010101011000001000001001001110101101110101010110100001100010010000110011010001011110111000010100111100111011100000111101010110000100011001101000011000011110101000010001001110111000101001000101000010110001010100011000000011000011010100001100110000010101010100011001010110001111000111011111011000111110001101010010001000000000101100110001011110010101011010101010000000101111001011111110000101000101100001100111100110101110000111101101000011101000011011010001111000100000010101110100110010001111000101011000011001111001110101101101101011001111111010111111100000001111100000011011000101011100110101111111101001111000100110100011100001000011001101111111011000001111011000010000011000000101000000101010101000010110110101001011111011000011000001000000101011100000011011110100000101100011111001100000100111011001111010101101001000100001101001101011011000011110100000010010100001110110110111011101100011100101111101010110000011010110101101000011101011100011110111001000011110111100000110010011101110000011010000101100100101001001111010101110001100101001011111010100000111000111111001101100111101110001010111"
    
    # Convert string to list of integers (binary format)
    # binary_data = [int(bit) for bit in binary_input]
    binary_data  = list(map(int, binary_input))
    # print(binary_data)

    try:
        p_value, result, details = coupon_collector_test_binary(binary_data)
        print(f"Coupon Collector's Test (Binary):")
        print(f"  P-Value: {p_value}")
        print(f"  Result: {result}")
        print(f"  Details: {details}")
    except Exception as e:
        print(f"Error: {e}")
